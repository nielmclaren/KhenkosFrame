import gab.opencv.*;

PImage sourceImage;
OpenCV opencv;
ArrayList<Line> lines;

void setup() {
  size(800, 800);
  sourceImage = loadImage("frame0001.bmp");
  
  opencv = new OpenCV(this, sourceImage);
  opencv.findCannyEdges(20, 75);

  // Find lines with Hough line detection
  // Arguments are: threshold, minLengthLength, maxLineGap
  lines = opencv.findLines(100, 30, 20);
}

void draw() {
  background(32);
  image(sourceImage, 0, 0);
  
  image(opencv.getOutput(), sourceImage.width, 0);
  strokeWeight(3);
  
  println(lines.size());
  
  for (Line line : lines) {
    if (line.angle >= radians(0) && line.angle < radians(1)) {
      stroke(0, 255, 0);
    } else if (line.angle > radians(89) && line.angle < radians(91)) {
      stroke(255, 0, 0);
    } else {
      stroke(0, 0, 255);
    }
    line(line.start.x, line.start.y, line.end.x, line.end.y);
  }
}